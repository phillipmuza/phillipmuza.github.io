define(["require", "exports", "lib/axios"], function (require, exports, axios_1) {
    "use strict";
    var MINIMUM_SECONDS_WATCHED_NEEDED_TO_COUNT_AS_PLAYED = 60;
    var VideoLessonTrackingService = (function () {
        function VideoLessonTrackingService() {
            var _this = this;
            Object.defineProperty(this, "trackedVideos", {
                enumerable: true,
                configurable: true,
                writable: true,
                value: {}
            });
            $("body").on("wistia-embed.ready", function (event, wistiaId) {
                var videoPlayTrackingData = _this.trackedVideos[wistiaId];
                if (videoPlayTrackingData) {
                    _this._attemptToInitVideoPlaytimeListenerIfNotInitialized(videoPlayTrackingData);
                }
            });
        }
        Object.defineProperty(VideoLessonTrackingService.prototype, "_attemptToInitVideoPlaytimeListenerIfNotInitialized", {
            enumerable: false,
            configurable: true,
            writable: true,
            value: function (videoPlayTrackingData) {
                var _this = this;
                if (videoPlayTrackingData.videoPlaytimeListenerInitialized) {
                    return;
                }
                require(["lib/wistia"], function (Wistia) {
                    var wistiaEmbedObject = Wistia.api(videoPlayTrackingData.wistiaId);
                    if (!wistiaEmbedObject) {
                        return;
                    }
                    wistiaEmbedObject.bind('secondchange', function () {
                        videoPlayTrackingData.secondsWatched = videoPlayTrackingData.secondsWatched + 1;
                        if (videoPlayTrackingData.secondsWatched === MINIMUM_SECONDS_WATCHED_NEEDED_TO_COUNT_AS_PLAYED) {
                            _this._recordVideoPlay(videoPlayTrackingData.academyAssetId);
                        }
                    });
                    videoPlayTrackingData.videoPlaytimeListenerInitialized = true;
                });
            }
        });
        Object.defineProperty(VideoLessonTrackingService.prototype, "_recordVideoPlay", {
            enumerable: false,
            configurable: true,
            writable: true,
            value: function (academyAssetId) {
                var videoPlay = {
                    academyAssetId: academyAssetId,
                };
                return axios_1.default.post("/academy/lesson/video-tracking/track-video-play.ajax", null, { params: videoPlay });
            }
        });
        Object.defineProperty(VideoLessonTrackingService.prototype, "trackVideoPlays", {
            enumerable: false,
            configurable: true,
            writable: true,
            value: function (wistiaId, academyAssetId) {
                var videoPlayTrackingData = {
                    wistiaId: wistiaId,
                    academyAssetId: academyAssetId,
                    secondsWatched: 0,
                    videoPlaytimeListenerInitialized: false
                };
                this.trackedVideos[wistiaId] = videoPlayTrackingData;
                this._attemptToInitVideoPlaytimeListenerIfNotInitialized(videoPlayTrackingData);
            }
        });
        return VideoLessonTrackingService;
    }());
    return VideoLessonTrackingService;
});

//# sourceMappingURL=videoLessonTrackingService.js.map
